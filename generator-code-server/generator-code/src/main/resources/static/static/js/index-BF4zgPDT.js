var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a,t)=>new Promise(((l,r)=>{var n=e=>{try{o(t.next(e))}catch(a){r(a)}},s=e=>{try{o(t.throw(e))}catch(a){r(a)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,s);o((t=t.apply(e,a)).next())}));import{H as u,d as i,v as d,D as c,h as p,I as m,J as v,A as g,i as f,a as b,j as y,C as h,z as _,c as w,b as k,K as O,w as C,E as N,L as q,M as x,u as S,O as P,P as U,Q as j,R as L,S as W,U as R,V as T,F as M,W as A,X as D,Y as I,o as E,Z as V,_ as $,$ as F,a0 as z,a1 as K,a2 as B,a3 as Q,a4 as H,B as J,t as Z,a5 as X,a6 as Y}from"./vendor-BT0L8wkZ.js";import{s as G,u as ee}from"./table-R7-h5oL5.js";import{_ as ae}from"./index-BIRohJrt.js";const te=u("vmsStore",{state:()=>({generators:[],serverOptions:[],webOptions:[],formValue:{author:"Bunny",packageName:"cn.bunny.services",requestMapping:"/api",className:"",tableName:"",simpleDateFormat:"yyyy-MM-dd HH:mm:ss",tablePrefixes:"t_,sys_,qrtz_,log_",comment:"",path:[]},formOption:{generatorServer:[],generatorWeb:[]}}),getters:{},actions:{generator(e){return o(this,null,(function*(){const o=yield(e=>G({url:"/vms/generator",method:"post",data:e}))(e);this.generators=o.data.map((e=>{return o=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e})({},e),u={path:e.path.replace(".vm","")},a(o,t(u));var o,u})),window.$message.success(`生成成功，共 ${this.generators.length} 数据`)}))},getVmsResourcePathList(){return o(this,null,(function*(){const e=yield G({url:"/vms/vmsResourcePathList",method:"get"});if(200!==e.code)return{};this.webOptions=e.data.web,this.serverOptions=e.data.server}))}}}),le=[{title:"序号",key:"no",titleAlign:"center",align:"center",render:(e,a)=>a+1},{title:"列名称",key:"columnName",titleAlign:"center",align:"center",render:e=>i(d,{type:"primary"},{default:()=>[e.columnName]})},{title:"字段名称",key:"lowercaseName",titleAlign:"center",align:"center",render:e=>i(d,null,{default:()=>[e.lowercaseName]})},{title:"数据库字段类型",key:"jdbcType",titleAlign:"center",align:"center",render:e=>i(d,null,{default:()=>[e.jdbcType]})},{title:"Java类型",key:"javaType",titleAlign:"center",align:"center",render:e=>i(d,{type:"warning"},{default:()=>[e.javaType]})},{title:"是否为主键",key:"isPrimaryKey",titleAlign:"center",align:"center",render:e=>e.isPrimaryKey?i(d,{type:"error"},{default:()=>[c("是")]}):i(d,{type:"success"},{default:()=>[c("否")]})},{title:"字段注释",key:"comment",titleAlign:"center",align:"center",render:e=>i(d,{type:"info"},{default:()=>[e.comment]})}],re=p({__name:"index",setup(e){const a=m(),t=ee(),l=v([]),r=v(!1),n=()=>o(this,null,(function*(){r.value=!0;const e=a.query.tableName;l.value=yield t.getTableColumnInfo(e),r.value=!1}));return g((()=>{n()})),(e,a)=>(b(),f(y(h),{bordered:!0,columns:y(le),data:l.value,loading:r.value},null,8,["columns","data","loading"]))}}),ne={class:"database-info"},se=ae(p({__name:"index",setup(e){const a=ee(),{databaseInfoMeta:t}=_(a);return g((()=>{a.getDatabaseInfoMeta()})),(e,a)=>(b(),w("div",ne,[k("p",null,[a[0]||(a[0]=c(" 数据库产品名称： ")),i(y(O),{type:"primary"},{default:C((()=>{var e;return[c(N(null==(e=y(t))?void 0:e.databaseProductName),1)]})),_:1})]),k("p",null,[a[1]||(a[1]=c(" 数据库产品版本： ")),i(y(O),{type:"primary"},{default:C((()=>{var e;return[c(N(null==(e=y(t))?void 0:e.databaseProductVersion),1)]})),_:1})]),k("p",null,[a[2]||(a[2]=c(" 驱动名称： ")),i(y(O),{type:"primary"},{default:C((()=>{var e;return[c(N(null==(e=y(t))?void 0:e.driverName),1)]})),_:1})]),k("p",null,[a[3]||(a[3]=c(" 数据库驱动版本： ")),i(y(O),{type:"primary"},{default:C((()=>{var e;return[c(N(null==(e=y(t))?void 0:e.driverVersion),1)]})),_:1})]),k("p",null,[a[4]||(a[4]=c(" 数据库用户： ")),i(y(O),{type:"primary"},{default:C((()=>{var e;return[c(N(null==(e=y(t))?void 0:e.username),1)]})),_:1})])]))}}),[["__scopeId","data-v-5045df9f"]]),oe=p({__name:"select-button-group",props:{data:{type:Array,required:!0},selected:{type:Array,default:()=>[]},idKey:{type:String,default:"name"}},emits:["update:selected"],setup(e,{emit:a}){const t=e,l=a,r=()=>{const e=t.data.map((e=>e[t.idKey]));l("update:selected",[...e])},n=()=>{const e=t.selected,a=t.data.map((e=>e[t.idKey])).filter((a=>!e.includes(a)));l("update:selected",a)},s=()=>{l("update:selected",[])};return(e,a)=>(b(),f(y(q),{size:"small"},{default:C((()=>[i(y(x),{round:"",type:"primary",onClick:r},{default:C((()=>a[0]||(a[0]=[c("全选")]))),_:1}),i(y(x),{type:"warning",onClick:n},{default:C((()=>a[1]||(a[1]=[c("反选")]))),_:1}),i(y(x),{round:"",type:"error",onClick:s},{default:C((()=>a[2]||(a[2]=[c("全不选")]))),_:1})])),_:1}))}});function ue(e,a){const t=new File([e],a,{type:"text/plain"}),l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=a,document.body.appendChild(r),r.click(),requestIdleCallback((()=>{document.body.removeChild(r),URL.revokeObjectURL(r.href)}))}const ie=te(),{formValue:de,formOption:ce}=_(ie),pe=e=>{de.value.tableName=e.toString();let a=e;de.value.tablePrefixes.split(/[,，]/).forEach((e=>{a=a.replace(e,"")})),de.value.className=a},me=()=>{ce.value.generatorServer=ie.serverOptions.map((e=>e.name)),ce.value.generatorWeb=ie.webOptions.map((e=>e.name))},ve=()=>{const e=ie.serverOptions.map((e=>e.name)),a=ce.value.generatorServer;ce.value.generatorServer=e.filter((e=>!a.includes(e)));const t=ie.webOptions.map((e=>e.name)),l=ce.value.generatorWeb;ce.value.generatorWeb=t.filter((e=>!l.includes(e)))},ge=()=>{ce.value.generatorServer=[],ce.value.generatorWeb=[],de.value.path=[]},fe=()=>{const e=ce.value.generatorWeb,a=ce.value.generatorServer;de.value.path=[...a,...e],de.value.path.length<=0&&window.$message.error("选择要生成的模板")},be=te(),{formOption:ye}=_(be),he=()=>ye.value.generatorServer.length>0||ye.value.generatorWeb.length>0,_e={author:{required:!0,trigger:["blur","change","input"],message:"作者不能为空"},packageName:{required:!0,trigger:["blur","change","input"],message:"包名不能为空"},requestMapping:{required:!0,trigger:["blur","change","input"],message:"请求路径不能为空"},className:{required:!0,trigger:["blur","change","input"],message:"类名不能为空"},tableName:{required:!0,trigger:["blur","change","input"],message:"表名不能为空"},simpleDateFormat:{required:!0,trigger:["blur","change","input"],message:"日期格式不能为空"},generatorServer:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的服务端",validator:he}],generatorWeb:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的前端",validator:he}]},we={class:"flex flex-wrap flex-col w-full"},ke=p({__name:"generator-form",setup(e){const a=m(),t=te(),{formValue:l,formOption:r}=_(t),n=S(),s=v(),u=P((()=>!(r.value.generatorWeb.length>0||r.value.generatorServer.length>0))),d=v(),p=e=>{var a;e.preventDefault(),null==(a=s.value)||a.validate((e=>o(this,null,(function*(){e?e.forEach((e=>{e.forEach((e=>{n.error(`${e.message}->${e.field}`)}))})):(fe(),yield t.generator(l.value))}))))},h=()=>{t.generators=[]},O=()=>{t.generators.forEach((e=>{ue(e.code,e.path.split("/")[1])}))},q=()=>o(this,null,(function*(){fe();var e;(e=>{try{const a=e.headers["content-disposition"];let t="download.zip";if(a){const e=a.match(/filename="?(.+)"?/);e&&e[1]&&(t=e[1])}const l=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=l,r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(l)}catch(a){}})(yield(e=l.value,G({url:"/vms/downloadByZip",method:"POST",data:e,responseType:"blob"})))})),E=()=>o(this,null,(function*(){const e={sql:d.value},{data:a}=yield(e=>G({url:"/sqlParser/tableInfo",method:"POST",params:e}))(e);l.value.comment=a.comment,l.value.tableName=a.tableName,pe(a.tableName)}));return g((()=>{const e=a.query.tableName;pe(e),t.getVmsResourcePathList()})),(e,a)=>(b(),f(y(U),{ref_key:"formRef",ref:s,"label-width":80,model:y(l),rules:y(_e)},{default:C((()=>[i(y(j),{cols:"24","item-responsive":"",responsive:"screen"},{default:C((()=>[i(y(L),{label:"如果有sql会生成sql中的信息，点击【解析SQL】会替换【表名称】和【注释名称】",path:"sql",span:"24"},{default:C((()=>[k("div",we,[i(y(W),{value:d.value,"onUpdate:value":a[0]||(a[0]=e=>d.value=e),autosize:{minRows:3},class:"w-full",placeholder:"SQL语句",type:"textarea"},null,8,["value"]),i(y(x),{class:"w-full mt-2",type:"primary",onClick:E},{default:C((()=>a[13]||(a[13]=[c("解析SQL")]))),_:1})])])),_:1})])),_:1}),i(y(j),{cols:24,"x-gap":5,"item-responsive":"",responsive:"screen"},{default:C((()=>[i(y(L),{label:"作者名称",path:"author",span:"12 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).author,"onUpdate:value":a[1]||(a[1]=e=>y(l).author=e),placeholder:"作者名称"},null,8,["value"])])),_:1}),i(y(L),{label:"requestMapping名称",path:"requestMapping",span:"12 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).requestMapping,"onUpdate:value":a[2]||(a[2]=e=>y(l).requestMapping=e),placeholder:"requestMapping名称"},null,8,["value"])])),_:1}),i(y(L),{label:"表名称",path:"tableName",span:"24 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).tableName,"onUpdate:value":a[3]||(a[3]=e=>y(l).tableName=e),placeholder:"表名称"},null,8,["value"])])),_:1}),i(y(L),{label:"类名称",path:"className",span:"24 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).className,"onUpdate:value":a[4]||(a[4]=e=>y(l).className=e),placeholder:"类名称"},null,8,["value"])])),_:1}),i(y(L),{label:"包名称",path:"packageName",span:"24 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).packageName,"onUpdate:value":a[5]||(a[5]=e=>y(l).packageName=e),placeholder:"包名称"},null,8,["value"])])),_:1}),i(y(L),{label:"时间格式",path:"simpleDateFormat",span:"24 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).simpleDateFormat,"onUpdate:value":a[6]||(a[6]=e=>y(l).simpleDateFormat=e),placeholder:"时间格式"},null,8,["value"])])),_:1}),i(y(L),{label:"去除开头前缀",path:"tablePrefixes",span:"12 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).tablePrefixes,"onUpdate:value":a[7]||(a[7]=e=>y(l).tablePrefixes=e),placeholder:"去除开头前缀"},null,8,["value"])])),_:1}),i(y(L),{label:"注释名称",path:"comment",span:"12 m:8 l:6"},{default:C((()=>[i(y(W),{value:y(l).comment,"onUpdate:value":a[8]||(a[8]=e=>y(l).comment=e),placeholder:"修改注释名称"},null,8,["value"])])),_:1})])),_:1}),i(y(j),{cols:24,"x-gap":5,"item-responsive":"",responsive:"screen"},{default:C((()=>[i(y(L),{label:"生成后端",path:"generatorServer",span:"24 m:24 l:12"},{default:C((()=>[i(y(R),{value:y(r).generatorServer,"onUpdate:value":a[10]||(a[10]=e=>y(r).generatorServer=e)},{default:C((()=>[i(y(T),null,{default:C((()=>[(b(!0),w(M,null,A(y(t).serverOptions,((e,a)=>(b(),f(y(I),{key:a,value:e.name},{default:C((()=>[c(N(e.label),1)])),_:2},1032,["value"])))),128)),i(oe,{selected:y(r).generatorServer,"onUpdate:selected":a[9]||(a[9]=e=>y(r).generatorServer=e),data:y(t).serverOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1}),i(y(L),{label:"生成前端",path:"generatorWeb",span:"24 m:24 l:12"},{default:C((()=>[i(y(R),{value:y(r).generatorWeb,"onUpdate:value":a[12]||(a[12]=e=>y(r).generatorWeb=e)},{default:C((()=>[i(y(T),null,{default:C((()=>[(b(!0),w(M,null,A(y(t).webOptions,((e,a)=>(b(),f(y(I),{key:a,value:e.name,"onUpdate:value":a=>e.name=a},{default:C((()=>[c(N(e.label),1)])),_:2},1032,["value","onUpdate:value"])))),128)),i(oe,{selected:y(r).generatorWeb,"onUpdate:selected":a[11]||(a[11]=e=>y(r).generatorWeb=e),data:y(t).webOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1})])),_:1}),i(y(j),{cols:"24","item-responsive":"",responsive:"screen"},{default:C((()=>[i(y(D),{class:"mt-2",span:"24 m:12 l:8"},{default:C((()=>[i(y(x),{"attr-type":"button",type:"success",onClick:y(me)},{default:C((()=>a[14]||(a[14]=[c("全部选择")]))),_:1},8,["onClick"]),i(y(x),{"attr-type":"button",type:"warning",onClick:y(ve)},{default:C((()=>a[15]||(a[15]=[c("全部反选")]))),_:1},8,["onClick"]),i(y(x),{"attr-type":"button",type:"error",onClick:y(ge)},{default:C((()=>a[16]||(a[16]=[c("全选取消")]))),_:1},8,["onClick"])])),_:1}),i(y(D),{class:"mt-2",span:"24 m:12 l:8"},{default:C((()=>[i(y(x),{"attr-type":"button",type:"success",onClick:p},{default:C((()=>a[17]||(a[17]=[c("开始生成")]))),_:1}),i(y(x),{"attr-type":"button",type:"error",onClick:h},{default:C((()=>a[18]||(a[18]=[c("清空已生成")]))),_:1}),i(y(x),{disabled:!(y(t).generators.length>0),"attr-type":"button",type:"primary",onClick:O},{default:C((()=>[c(" 下载全部 "+N(y(t).generators.length),1)])),_:1},8,["disabled"])])),_:1}),i(y(D),{class:"mt-2",span:"24 m:12 l:8"},{default:C((()=>[i(y(x),{disabled:y(u),"attr-type":"button",class:"w-full",type:"success",onClick:q},{default:C((()=>a[19]||(a[19]=[c(" 下载zip ")]))),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1},8,["model","rules"]))}}),Oe=e=>{const a=document.createElement("textarea");a.value=e,a.style.position="fixed",document.body.appendChild(a),a.select();try{document.execCommand("copy")?window.$message.success("复制成功！"):window.$message.success("复制失败！")}catch(t){window.$message.success("复制失败！请手动复制")}finally{document.body.removeChild(a)}},Ce=p({__name:"generator-preview",setup(e){const a=E.component,t=V(),l=S(),r=te();return(e,n)=>$((b(),f(y(z),{class:"mt-4 p-2 border"},{default:C((()=>[(b(!0),w(M,null,A(y(r).generators,((e,r)=>(b(),f(y(K),{key:r,name:e.path,title:e.path,class:"pos-relative"},{"header-extra":C((()=>[i(y(x),{quaternary:"",type:"info",onClick:a=>((e,a)=>{const r=a.split("/"),n=v(r.at(-1));t.info({title:"修改文件名",positiveText:"下载",negativeText:"取消",content:()=>i(W,{placeholder:"Tiny Input",clearable:!0,value:n.value,onInput:e=>n.value=e},null),onPositiveClick:()=>{ue(e,n.value)},onNegativeClick:()=>{l.info("取消下载")}})})(e.code,e.path)},{default:C((()=>n[0]||(n[0]=[c("下载")]))),_:2},1032,["onClick"])])),default:C((()=>[i(y(x),{class:"pos-absolute right-0",color:"#ff69b4",quaternary:"",onClick:a=>y(Oe)(e.code)},{icon:C((()=>[i(y(B),null,{default:C((()=>[i(y(Q))])),_:1})])),default:C((()=>[n[1]||(n[1]=c(" 复制 "))])),_:2},1032,["onClick"]),i(y(a),{autodetect:!0,code:e.code,language:"JavaScript"},null,8,["code"])])),_:2},1032,["name","title"])))),128))])),_:1},512)),[[F,y(r).generators.length>0]])}}),Ne=p({__name:"index",setup:e=>(e,a)=>(b(),w(M,null,[i(ke),i(Ce)],64))}),qe=p({__name:"index",setup(e){const a=Z(),t=m(),l=ee(),r=te(),{formValue:n}=_(r),s=H({tableName:"",comment:"",tableCat:"",tableType:""}),u=()=>o(this,null,(function*(){const e=t.query.tableName,a=yield l.getTableMetaData(e);Object.assign(s,a),n.value.comment=s.comment}));return g((()=>{u()})),(e,l)=>(b(),f(y(J),null,{header:C((()=>[i(y(J),{title:"数据库信息"},{default:C((()=>[k("span",{class:"color-blue cursor-pointer",onClick:l[0]||(l[0]=e=>y(a).push("/"))},"回到首页"),k("ul",null,[k("li",null,"表名："+N(y(t).query.tableName),1),k("li",null,"表注释："+N(s.comment),1),k("li",null,"数据库名："+N(s.tableCat),1),k("li",null,"类型："+N(s.tableType),1)])])),_:1})])),default:C((()=>[i(y(Y),{animated:"",type:"line"},{default:C((()=>[i(y(X),{name:"generator-code",tab:"生成"},{default:C((()=>[i(Ne)])),_:1}),i(y(X),{name:"connect-info",tab:"连接信息"},{default:C((()=>[i(se)])),_:1}),i(y(X),{name:"columns-info",tab:"列字段"},{default:C((()=>[i(re)])),_:1})])),_:1})])),_:1}))}});export{qe as default};
