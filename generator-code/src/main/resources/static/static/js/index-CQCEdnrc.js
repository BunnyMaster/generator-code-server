var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,u=(e,a,t)=>new Promise(((l,r)=>{var n=e=>{try{u(t.next(e))}catch(a){r(a)}},s=e=>{try{u(t.throw(e))}catch(a){r(a)}},u=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,s);u((t=t.apply(e,a)).next())}));import{b as o,s as i,y as p,g as d,A as c,B as g,t as m,h as f,o as b,i as v,x as y,C as h,D as _,w as k,E as w,G as N,c as O,F as C,H as q,I as x,J as P,K as S,L as U,M as j,O as W,z as A,P as M,u as T,Q as D,R as L,S as E,U as F,V as R,W as I,v as K,q as $,X as z,Y as V,a as H}from"./vendor-BkJtItE3.js";import{u as B,s as J}from"./table-4Oe8H9vJ.js";const G=[{title:"序号",key:"no",titleAlign:"center",align:"center",render:(e,a)=>a+1},{title:"列名称",key:"columnName",titleAlign:"center",align:"center",render:e=>o(i,{type:"primary"},{default:()=>[e.columnName]})},{title:"字段名称",key:"fieldName",titleAlign:"center",align:"center",render:e=>o(i,null,{default:()=>[e.fieldName]})},{title:"数据库字段类型",key:"jdbcType",titleAlign:"center",align:"center",render:e=>o(i,null,{default:()=>[e.jdbcType]})},{title:"Java类型",key:"javaType",titleAlign:"center",align:"center",render:e=>o(i,{type:"warning"},{default:()=>[e.javaType]})},{title:"是否为主键",key:"isPrimaryKey",titleAlign:"center",align:"center",render:e=>e.isPrimaryKey?o(i,{type:"error"},{default:()=>[p("是")]}):o(i,{type:"success"},{default:()=>[p("否")]})},{title:"字段注释",key:"comment",titleAlign:"center",align:"center",render:e=>o(i,{type:"info"},{default:()=>[e.comment]})}],Q=d({__name:"index",setup(e){const a=c(),t=B(),l=g([]),r=()=>u(this,null,(function*(){const e=a.query.tableName;l.value=yield t.getColumnInfo(e)}));return m((()=>{r()})),(e,a)=>(b(),f(v(y),{bordered:!0,columns:v(G),data:l.value},null,8,["columns","data"]))}}),X=h("vmsStore",{state:()=>({generators:[],serverOptions:[],webOptions:[]}),getters:{},actions:{generator(e){return u(this,null,(function*(){const u=yield(e=>J({url:"/vms/generator",method:"post",data:e}))(e);200!==u.code&&window.$message.error(u.message),this.generators=u.data.map((e=>{return u=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e})({},e),o={path:e.path.replace(".vm","")},a(u,t(o));var u,o})),window.$message.success(`生成成功，共 ${this.generators.length} 数据`)}))},getVmsPathList(){return u(this,null,(function*(){const e=yield J({url:"/vms/getVmsPathList",method:"get"});if(200!==e.code)return window.$message.error(e.message),{};this.webOptions=e.data.web,this.serverOptions=e.data.server}))}}});function Y(e,a){const t=new File([e],a,{type:"text/plain"}),l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=a,document.body.appendChild(r),r.click(),requestIdleCallback((()=>{document.body.removeChild(r),URL.revokeObjectURL(r.href)}))}const Z=d({__name:"select-button-group",props:{data:{type:Array,required:!0},selected:{type:Array,default:()=>[]},idKey:{type:String,default:"name"}},emits:["update:selected"],setup(e,{emit:a}){const t=e,l=a,r=()=>{const e=t.data.map((e=>e[t.idKey]));l("update:selected",[...e])},n=()=>{const e=t.selected,a=t.data.map((e=>e[t.idKey])).filter((a=>!e.includes(a)));l("update:selected",a)},s=()=>{l("update:selected",[])};return(e,a)=>(b(),f(v(_),{size:"small"},{default:k((()=>[o(v(w),{round:"",type:"primary",onClick:r},{default:k((()=>a[0]||(a[0]=[p("全选")]))),_:1}),o(v(w),{type:"warning",onClick:n},{default:k((()=>a[1]||(a[1]=[p("反选")]))),_:1}),o(v(w),{round:"",type:"error",onClick:s},{default:k((()=>a[2]||(a[2]=[p("全不选")]))),_:1})])),_:1}))}}),ee=X(),ae=N({generatorServer:[],generatorWeb:[]}),te=N({author:"Bunny",packageName:"cn.bunny.services",requestMapping:"/api",className:"",tableName:"",simpleDateFormat:"yyyy-MM-dd HH:mm:ss",tablePrefixes:"t_,sys_,qrtz_,log_",path:[]}),le=()=>{ae.generatorServer=ee.serverOptions.map((e=>e.name)),ae.generatorWeb=ee.webOptions.map((e=>e.name))},re=()=>{const e=ee.serverOptions.map((e=>e.name)),a=ae.generatorServer;ae.generatorServer=e.filter((e=>!a.includes(e)));const t=ee.webOptions.map((e=>e.name)),l=ae.generatorWeb;ae.generatorWeb=t.filter((e=>!l.includes(e)))},ne=()=>{ae.generatorServer=[],ae.generatorWeb=[],te.path=[]},se=()=>ae.generatorServer.length>0||ae.generatorWeb.length>0,ue={author:{required:!0,trigger:["blur","change","input"],message:"作者不能为空"},packageName:{required:!0,trigger:["blur","change","input"],message:"包名不能为空"},requestMapping:{required:!0,trigger:["blur","change","input"],message:"请求路径不能为空"},className:{required:!0,trigger:["blur","change","input"],message:"类名不能为空"},tableName:{required:!0,trigger:["blur","change","input"],message:"表名不能为空"},simpleDateFormat:{required:!0,trigger:["blur","change","input"],message:"日期格式不能为空"},generatorServer:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的服务端",validator:se}],generatorWeb:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的前端",validator:se}]},oe=d({__name:"generator-form",setup(e){const a=X();return(e,t)=>(b(),O(C,null,[o(v(q),{cols:24,"x-gap":24},{default:k((()=>[o(v(x),{span:8,label:"作者名称",path:"author"},{default:k((()=>[o(v(P),{value:v(te).author,"onUpdate:value":t[0]||(t[0]=e=>v(te).author=e),placeholder:"输入姓名"},null,8,["value"])])),_:1}),o(v(x),{span:8,label:"requestMapping名称",path:"requestMapping"},{default:k((()=>[o(v(P),{value:v(te).requestMapping,"onUpdate:value":t[1]||(t[1]=e=>v(te).requestMapping=e),placeholder:"输入年龄"},null,8,["value"])])),_:1}),o(v(x),{span:8,label:"表名称",path:"tableName"},{default:k((()=>[o(v(P),{value:v(te).tableName,"onUpdate:value":t[2]||(t[2]=e=>v(te).tableName=e),placeholder:"电话号码"},null,8,["value"])])),_:1})])),_:1}),o(v(q),{cols:24,"x-gap":24},{default:k((()=>[o(v(x),{span:8,label:"类名称",path:"className"},{default:k((()=>[o(v(P),{value:v(te).className,"onUpdate:value":t[3]||(t[3]=e=>v(te).className=e),placeholder:"电话号码"},null,8,["value"])])),_:1}),o(v(x),{span:8,label:"包名称",path:"packageName"},{default:k((()=>[o(v(P),{value:v(te).packageName,"onUpdate:value":t[4]||(t[4]=e=>v(te).packageName=e),placeholder:"电话号码"},null,8,["value"])])),_:1}),o(v(x),{span:8,label:"时间格式",path:"simpleDateFormat"},{default:k((()=>[o(v(P),{value:v(te).simpleDateFormat,"onUpdate:value":t[5]||(t[5]=e=>v(te).simpleDateFormat=e),placeholder:"电话号码"},null,8,["value"])])),_:1})])),_:1}),o(v(q),{cols:24,"x-gap":24},{default:k((()=>[o(v(x),{span:8,label:"去除开头前缀",path:"tablePrefixes"},{default:k((()=>[o(v(P),{value:v(te).tablePrefixes,"onUpdate:value":t[6]||(t[6]=e=>v(te).tablePrefixes=e),placeholder:"电话号码"},null,8,["value"])])),_:1}),o(v(x),{span:8,label:"生成后端",path:"generatorServer"},{default:k((()=>[o(v(S),{value:v(ae).generatorServer,"onUpdate:value":t[8]||(t[8]=e=>v(ae).generatorServer=e)},{default:k((()=>[o(v(U),null,{default:k((()=>[(b(!0),O(C,null,j(v(a).serverOptions,((e,a)=>(b(),f(v(W),{key:a,value:e.name},{default:k((()=>[p(A(e.label),1)])),_:2},1032,["value"])))),128)),o(Z,{selected:v(ae).generatorServer,"onUpdate:selected":t[7]||(t[7]=e=>v(ae).generatorServer=e),data:v(a).serverOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1}),o(v(x),{span:8,label:"生成前端",path:"generatorWeb"},{default:k((()=>[o(v(S),{value:v(ae).generatorWeb,"onUpdate:value":t[10]||(t[10]=e=>v(ae).generatorWeb=e)},{default:k((()=>[o(v(U),null,{default:k((()=>[(b(!0),O(C,null,j(v(a).webOptions,((e,a)=>(b(),f(v(W),{key:a,value:e.name,"onUpdate:value":a=>e.name=a},{default:k((()=>[p(A(e.label),1)])),_:2},1032,["value","onUpdate:value"])))),128)),o(Z,{selected:v(ae).generatorWeb,"onUpdate:selected":t[9]||(t[9]=e=>v(ae).generatorWeb=e),data:v(a).webOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1})])),_:1})],64))}}),ie=d({__name:"generator-preview",setup(e){const a=M(),t=T(),l=X();return(e,r)=>(b(),f(v(D),null,{default:k((()=>[(b(!0),O(C,null,j(v(l).generators,((e,l)=>(b(),f(v(L),{key:l,name:e.path,title:e.path},{"header-extra":k((()=>[o(v(w),{quaternary:"",type:"info",onClick:l=>((e,l)=>{l=l.split("/")[1];const r=g(l);a.info({title:"修改文件名",positiveText:"下载",negativeText:"取消",content:()=>o(P,{placeholder:"Tiny Input",clearable:!0,value:r.value,onInput:e=>r.value=e},null),onPositiveClick:()=>{Y(e,r.value)},onNegativeClick:()=>{t.info("取消下载")}})})(e.code,e.path)},{default:k((()=>r[0]||(r[0]=[p("下载")]))),_:2},1032,["onClick"])])),default:k((()=>[o(v(P),{autosize:{minRows:3},placeholder:e.comment,value:e.code,type:"textarea"},null,8,["placeholder","value"])])),_:2},1032,["name","title"])))),128))])),_:1}))}}),pe=d({__name:"index",setup(e){const a=c(),t=X(),l=T(),r=g(),n=e=>{var a;e.preventDefault(),null==(a=r.value)||a.validate((e=>u(this,null,(function*(){if(e)e.forEach((e=>{e.forEach((e=>{l.error(`${e.message}->${e.field}`)}))}));else{const e=ae.generatorWeb,a=ae.generatorServer;if(te.path=[...a,...e],te.path.length<=0)return void l.error("选择要生成的模板");yield t.generator(I(te))}}))))},s=()=>{t.generators.forEach((e=>{Y(e.code,e.path.split("/")[1])}))};return m((()=>{(e=>{te.tableName=e.toString();let a=e;te.tablePrefixes.split(/[,，]/).forEach((e=>{a=a.replace(e,"")})),te.className=a})(a.query.tableName),t.getVmsPathList()})),(e,a)=>(b(),O(C,null,[o(v(E),{ref_key:"formRef",ref:r,"label-width":80,model:v(te),rules:v(ue)},{default:k((()=>[o(oe),o(v(F),null,{default:k((()=>[o(v(q),{class:"justify-items-center",cols:"3","x-gap":"24"},{default:k((()=>[o(v(R),null,{default:k((()=>[o(v(w),{"attr-type":"button",type:"success",onClick:v(le)},{default:k((()=>a[1]||(a[1]=[p("全部选择")]))),_:1},8,["onClick"]),o(v(w),{"attr-type":"button",type:"warning",onClick:v(re)},{default:k((()=>a[2]||(a[2]=[p("全部反选")]))),_:1},8,["onClick"]),o(v(w),{"attr-type":"button",type:"error",onClick:v(ne)},{default:k((()=>a[3]||(a[3]=[p("全选取消")]))),_:1},8,["onClick"])])),_:1}),o(v(R),null,{default:k((()=>[o(v(w),{"attr-type":"button",type:"success",onClick:n},{default:k((()=>a[4]||(a[4]=[p("开始生成")]))),_:1}),o(v(w),{"attr-type":"button",type:"error",onClick:a[0]||(a[0]=()=>v(t).generators=[])},{default:k((()=>a[5]||(a[5]=[p(" 清空已生成 ")]))),_:1}),o(v(w),{disabled:!(v(t).generators.length>0),"attr-type":"button",type:"primary",onClick:s},{default:k((()=>[p(" 下载全部 "+A(v(t).generators.length),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"]),o(ie)],64))}}),de=d({__name:"index",setup(e){const a=$(),t=c(),l=B(),r=N({tableName:"",comment:"",tableCat:"",tableType:""}),n=()=>u(this,null,(function*(){const e=t.query.tableName,a=yield l.getTableMetaData(e);Object.assign(r,a)}));return m((()=>{n()})),(e,l)=>(b(),f(v(K),null,{header:k((()=>[o(v(K),{title:"数据库信息"},{default:k((()=>[H("span",{class:"color-blue",onClick:l[0]||(l[0]=e=>v(a).push("/"))},"回到首页"),H("ul",null,[H("li",null,"表名："+A(v(t).query.tableName),1),H("li",null,"表注释："+A(r.comment),1),H("li",null,"数据库名："+A(r.tableCat),1),H("li",null,"类型："+A(r.tableType),1)])])),_:1})])),default:k((()=>[o(v(V),{animated:"",type:"line"},{default:k((()=>[o(v(z),{name:"generator-code",tab:"生成"},{default:k((()=>[o(pe)])),_:1}),o(v(z),{name:"columns-info",tab:"列字段"},{default:k((()=>[o(Q)])),_:1})])),_:1})])),_:1}))}});export{de as default};
