var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a,t)=>new Promise(((l,r)=>{var n=e=>{try{o(t.next(e))}catch(a){r(a)}},s=e=>{try{o(t.throw(e))}catch(a){r(a)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,s);o((t=t.apply(e,a)).next())}));import{b as u,t as i,z as d,g as p,E as c,G as m,v as g,h as v,o as f,i as b,y,H as h,I as _,w as k,J as w,K as O,c as N,F as C,L as q,M as U,O as x,P,Q as S,R as j,S as W,A as L,U as T,u as A,V as M,W as R,X as V,Y as D,Z as E,_ as $,$ as F,x as z,q as I,a0 as K,a1 as B,a as G}from"./vendor-B-dPIqey.js";import{u as H,s as J}from"./table-BWSEVs0u.js";const Z=[{title:"序号",key:"no",titleAlign:"center",align:"center",render:(e,a)=>a+1},{title:"列名称",key:"columnName",titleAlign:"center",align:"center",render:e=>u(i,{type:"primary"},{default:()=>[e.columnName]})},{title:"字段名称",key:"fieldName",titleAlign:"center",align:"center",render:e=>u(i,null,{default:()=>[e.fieldName]})},{title:"数据库字段类型",key:"jdbcType",titleAlign:"center",align:"center",render:e=>u(i,null,{default:()=>[e.jdbcType]})},{title:"Java类型",key:"javaType",titleAlign:"center",align:"center",render:e=>u(i,{type:"warning"},{default:()=>[e.javaType]})},{title:"是否为主键",key:"isPrimaryKey",titleAlign:"center",align:"center",render:e=>e.isPrimaryKey?u(i,{type:"error"},{default:()=>[d("是")]}):u(i,{type:"success"},{default:()=>[d("否")]})},{title:"字段注释",key:"comment",titleAlign:"center",align:"center",render:e=>u(i,{type:"info"},{default:()=>[e.comment]})}],Q=p({__name:"index",setup(e){const a=c(),t=H(),l=m([]),r=()=>o(this,null,(function*(){const e=a.query.tableName;l.value=yield t.getColumnInfo(e)}));return g((()=>{r()})),(e,a)=>(f(),v(b(y),{bordered:!0,columns:b(Z),data:l.value},null,8,["columns","data"]))}}),X=h("vmsStore",{persist:{paths:["formValue","formOption"]},state:()=>({generators:[],serverOptions:[],webOptions:[],formValue:{author:"Bunny",packageName:"cn.bunny.services",requestMapping:"/api",className:"",tableName:"",simpleDateFormat:"yyyy-MM-dd HH:mm:ss",tablePrefixes:"t_,sys_,qrtz_,log_",path:[]},formOption:{generatorServer:[],generatorWeb:[]}}),getters:{},actions:{generator(e){return o(this,null,(function*(){const o=yield(e=>J({url:"/vms/generator",method:"post",data:e}))(e);200!==o.code&&window.$message.error(o.message),this.generators=o.data.map((e=>{return o=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e})({},e),u={path:e.path.replace(".vm","")},a(o,t(u));var o,u})),window.$message.success(`生成成功，共 ${this.generators.length} 数据`)}))},getVmsPathList(){return o(this,null,(function*(){const e=yield J({url:"/vms/getVmsPathList",method:"get"});if(200!==e.code)return window.$message.error(e.message),{};this.webOptions=e.data.web,this.serverOptions=e.data.server}))},clearGenerators(){this.generators=[]}}});function Y(e,a){const t=new File([e],a,{type:"text/plain"}),l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=a,document.body.appendChild(r),r.click(),requestIdleCallback((()=>{document.body.removeChild(r),URL.revokeObjectURL(r.href)}))}const ee=p({__name:"select-button-group",props:{data:{type:Array,required:!0},selected:{type:Array,default:()=>[]},idKey:{type:String,default:"name"}},emits:["update:selected"],setup(e,{emit:a}){const t=e,l=a,r=()=>{const e=t.data.map((e=>e[t.idKey]));l("update:selected",[...e])},n=()=>{const e=t.selected,a=t.data.map((e=>e[t.idKey])).filter((a=>!e.includes(a)));l("update:selected",a)},s=()=>{l("update:selected",[])};return(e,a)=>(f(),v(b(_),{size:"small"},{default:k((()=>[u(b(w),{round:"",type:"primary",onClick:r},{default:k((()=>a[0]||(a[0]=[d("全选")]))),_:1}),u(b(w),{type:"warning",onClick:n},{default:k((()=>a[1]||(a[1]=[d("反选")]))),_:1}),u(b(w),{round:"",type:"error",onClick:s},{default:k((()=>a[2]||(a[2]=[d("全不选")]))),_:1})])),_:1}))}}),ae=p({__name:"generator-form",setup(e){const a=X(),{formValue:t,formOption:l}=O(a);return(e,r)=>(f(),N(C,null,[u(b(q),{cols:24,"x-gap":24},{default:k((()=>[u(b(U),{span:8,label:"作者名称",path:"author"},{default:k((()=>[u(b(x),{value:b(t).author,"onUpdate:value":r[0]||(r[0]=e=>b(t).author=e),placeholder:"作者名称"},null,8,["value"])])),_:1}),u(b(U),{span:8,label:"requestMapping名称",path:"requestMapping"},{default:k((()=>[u(b(x),{value:b(t).requestMapping,"onUpdate:value":r[1]||(r[1]=e=>b(t).requestMapping=e),placeholder:"requestMapping名称"},null,8,["value"])])),_:1}),u(b(U),{span:8,label:"表名称",path:"tableName"},{default:k((()=>[u(b(x),{value:b(t).tableName,"onUpdate:value":r[2]||(r[2]=e=>b(t).tableName=e),placeholder:"表名称"},null,8,["value"])])),_:1})])),_:1}),u(b(q),{cols:24,"x-gap":24},{default:k((()=>[u(b(U),{span:8,label:"类名称",path:"className"},{default:k((()=>[u(b(x),{value:b(t).className,"onUpdate:value":r[3]||(r[3]=e=>b(t).className=e),placeholder:"类名称"},null,8,["value"])])),_:1}),u(b(U),{span:8,label:"包名称",path:"packageName"},{default:k((()=>[u(b(x),{value:b(t).packageName,"onUpdate:value":r[4]||(r[4]=e=>b(t).packageName=e),placeholder:"包名称"},null,8,["value"])])),_:1}),u(b(U),{span:8,label:"时间格式",path:"simpleDateFormat"},{default:k((()=>[u(b(x),{value:b(t).simpleDateFormat,"onUpdate:value":r[5]||(r[5]=e=>b(t).simpleDateFormat=e),placeholder:"时间格式"},null,8,["value"])])),_:1})])),_:1}),u(b(q),{cols:24,"x-gap":24},{default:k((()=>[u(b(U),{span:8,label:"去除开头前缀",path:"tablePrefixes"},{default:k((()=>[u(b(x),{value:b(t).tablePrefixes,"onUpdate:value":r[6]||(r[6]=e=>b(t).tablePrefixes=e),placeholder:"电话号码"},null,8,["value"])])),_:1}),u(b(U),{span:8,label:"生成后端",path:"generatorServer"},{default:k((()=>[u(b(P),{value:b(l).generatorServer,"onUpdate:value":r[8]||(r[8]=e=>b(l).generatorServer=e)},{default:k((()=>[u(b(S),null,{default:k((()=>[(f(!0),N(C,null,j(b(a).serverOptions,((e,a)=>(f(),v(b(W),{key:a,value:e.name},{default:k((()=>[d(L(e.label),1)])),_:2},1032,["value"])))),128)),u(ee,{selected:b(l).generatorServer,"onUpdate:selected":r[7]||(r[7]=e=>b(l).generatorServer=e),data:b(a).serverOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1}),u(b(U),{span:8,label:"生成前端",path:"generatorWeb"},{default:k((()=>[u(b(P),{value:b(l).generatorWeb,"onUpdate:value":r[10]||(r[10]=e=>b(l).generatorWeb=e)},{default:k((()=>[u(b(S),null,{default:k((()=>[(f(!0),N(C,null,j(b(a).webOptions,((e,a)=>(f(),v(b(W),{key:a,value:e.name,"onUpdate:value":a=>e.name=a},{default:k((()=>[d(L(e.label),1)])),_:2},1032,["value","onUpdate:value"])))),128)),u(ee,{selected:b(l).generatorWeb,"onUpdate:selected":r[9]||(r[9]=e=>b(l).generatorWeb=e),data:b(a).webOptions,"id-key":"name"},null,8,["selected","data"])])),_:1})])),_:1},8,["value"])])),_:1})])),_:1})],64))}}),te=p({__name:"generator-preview",setup(e){const a=T(),t=A(),l=X();return(e,r)=>(f(),v(b(M),null,{default:k((()=>[(f(!0),N(C,null,j(b(l).generators,((e,l)=>(f(),v(b(R),{key:l,name:e.path,title:e.path},{"header-extra":k((()=>[u(b(w),{quaternary:"",type:"info",onClick:l=>((e,l)=>{l=l.split("/")[1];const r=m(l);a.info({title:"修改文件名",positiveText:"下载",negativeText:"取消",content:()=>u(x,{placeholder:"Tiny Input",clearable:!0,value:r.value,onInput:e=>r.value=e},null),onPositiveClick:()=>{Y(e,r.value)},onNegativeClick:()=>{t.info("取消下载")}})})(e.code,e.path)},{default:k((()=>r[0]||(r[0]=[d("下载")]))),_:2},1032,["onClick"])])),default:k((()=>[u(b(x),{autosize:{minRows:3},placeholder:e.comment,value:e.code,type:"textarea"},null,8,["placeholder","value"])])),_:2},1032,["name","title"])))),128))])),_:1}))}}),le=X(),{formValue:re,formOption:ne}=O(le),se=()=>{ne.value.generatorServer=le.serverOptions.map((e=>e.name)),ne.value.generatorWeb=le.webOptions.map((e=>e.name))},oe=()=>{const e=le.serverOptions.map((e=>e.name)),a=ne.value.generatorServer;ne.value.generatorServer=e.filter((e=>!a.includes(e)));const t=le.webOptions.map((e=>e.name)),l=ne.value.generatorWeb;ne.value.generatorWeb=t.filter((e=>!l.includes(e)))},ue=()=>{ne.value.generatorServer=[],ne.value.generatorWeb=[],re.value.path=[]},ie=()=>{const e=ne.value.generatorWeb,a=ne.value.generatorServer;re.value.path=[...a,...e],re.value.path.length<=0&&window.$message.error("选择要生成的模板")},de=X(),{formOption:pe}=O(de),ce=()=>pe.value.generatorServer.length>0||pe.value.generatorWeb.length>0,me={author:{required:!0,trigger:["blur","change","input"],message:"作者不能为空"},packageName:{required:!0,trigger:["blur","change","input"],message:"包名不能为空"},requestMapping:{required:!0,trigger:["blur","change","input"],message:"请求路径不能为空"},className:{required:!0,trigger:["blur","change","input"],message:"类名不能为空"},tableName:{required:!0,trigger:["blur","change","input"],message:"表名不能为空"},simpleDateFormat:{required:!0,trigger:["blur","change","input"],message:"日期格式不能为空"},generatorServer:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的服务端",validator:ce}],generatorWeb:[{required:!0,trigger:["blur","change","input"],message:"选择要生成的前端",validator:ce}]},ge=p({__name:"index",setup(e){const a=c(),t=X(),{formValue:l,formOption:r}=O(t),n=A(),s=m(),i=V((()=>!(r.value.generatorWeb.length>0||r.value.generatorServer.length>0))),p=e=>{var a;e.preventDefault(),null==(a=s.value)||a.validate((e=>o(this,null,(function*(){e?e.forEach((e=>{e.forEach((e=>{n.error(`${e.message}->${e.field}`)}))})):(ie(),yield t.generator(l.value))}))))},v=()=>{t.generators.forEach((e=>{Y(e.code,e.path.split("/")[1])}))},y=()=>o(this,null,(function*(){ie();var e;(e=>{try{const a=e.headers["content-disposition"];let t="download.zip";if(a){const e=a.match(/filename="?(.+)"?/);e&&e[1]&&(t=e[1])}const l=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=l,r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(l)}catch(a){}})(yield(e=l.value,J({url:"/vms/downloadByZip",method:"POST",data:e,responseType:"blob"})))}));return g((()=>{(e=>{re.value.tableName=e.toString();let a=e;re.value.tablePrefixes.split(/[,，]/).forEach((e=>{a=a.replace(e,"")})),re.value.className=a})(a.query.tableName),t.getVmsPathList()})),(e,a)=>(f(),N(C,null,[u(b(D),{ref_key:"formRef",ref:s,"label-width":80,model:b(l),rules:b(me)},{default:k((()=>[u(ae),u(b(E),null,{default:k((()=>[u(b(q),{class:"justify-items-center",cols:"3","x-gap":"24"},{default:k((()=>[u(b($),null,{default:k((()=>[u(b(w),{"attr-type":"button",type:"success",onClick:b(se)},{default:k((()=>a[1]||(a[1]=[d("全部选择")]))),_:1},8,["onClick"]),u(b(w),{"attr-type":"button",type:"warning",onClick:b(oe)},{default:k((()=>a[2]||(a[2]=[d("全部反选")]))),_:1},8,["onClick"]),u(b(w),{"attr-type":"button",type:"error",onClick:b(ue)},{default:k((()=>a[3]||(a[3]=[d("全选取消")]))),_:1},8,["onClick"])])),_:1}),u(b($),null,{default:k((()=>[u(b(w),{"attr-type":"button",type:"success",onClick:p},{default:k((()=>a[4]||(a[4]=[d("开始生成")]))),_:1}),u(b(w),{"attr-type":"button",type:"error",onClick:a[0]||(a[0]=e=>b(t).clearGenerators())},{default:k((()=>a[5]||(a[5]=[d(" 清空已生成 ")]))),_:1}),u(b(w),{disabled:!(b(t).generators.length>0),"attr-type":"button",type:"primary",onClick:v},{default:k((()=>[d(" 下载全部 "+L(b(t).generators.length),1)])),_:1},8,["disabled"])])),_:1}),u(b($),{class:"w-full"},{default:k((()=>[u(b(w),{disabled:b(i),"attr-type":"button",class:"w-full",type:"success",onClick:y},{default:k((()=>a[6]||(a[6]=[d(" 下载zip ")]))),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"]),u(te)],64))}}),ve=p({__name:"index",setup(e){const a=I(),t=c(),l=H(),r=F({tableName:"",comment:"",tableCat:"",tableType:""}),n=()=>o(this,null,(function*(){const e=t.query.tableName,a=yield l.getTableMetaData(e);Object.assign(r,a)}));return g((()=>{n()})),(e,l)=>(f(),v(b(z),null,{header:k((()=>[u(b(z),{title:"数据库信息"},{default:k((()=>[G("span",{class:"color-blue",onClick:l[0]||(l[0]=e=>b(a).push("/"))},"回到首页"),G("ul",null,[G("li",null,"表名："+L(b(t).query.tableName),1),G("li",null,"表注释："+L(r.comment),1),G("li",null,"数据库名："+L(r.tableCat),1),G("li",null,"类型："+L(r.tableType),1)])])),_:1})])),default:k((()=>[u(b(B),{animated:"",type:"line"},{default:k((()=>[u(b(K),{name:"generator-code",tab:"生成"},{default:k((()=>[u(ge)])),_:1}),u(b(K),{name:"columns-info",tab:"列字段"},{default:k((()=>[u(Q)])),_:1})])),_:1})])),_:1}))}});export{ve as default};
